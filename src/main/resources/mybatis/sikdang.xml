<?xml version="1.0" encoding="UTF-8" ?> 
 
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.study.sikdang.SikdangMapper">

<insert id="create" parameterType="com.study.sikdang.SikdangDTO">
	insert into sikdang(
	sikid, sikname, sikphone, roadadd,
	jibunadd, sikurl, cox, coy, distance)
	values(#{sikid}, #{sikname}, #{sikphone}, #{roadadd},
	#{jibunadd}, #{sikurl}, #{cox}, #{coy}, 0)
</insert>

<select id="checkId" parameterType="String" resultType="int">
	select count(sikid)
	from sikdang
	where sikid = #{sikid}
</select>

<select id="list" resultType="com.study.sikdang.SikdangDTO">
	select * from sikdang
</select>

<select id="total" parameterType="Map" resultType="int">
	select count(*)
	from sikdang
	<where>
		<choose>
			<when test="col=='sikid'">
				sikid like '%'||#{word}||'%'
			</when>
			<when test="col=='sikname'">
				sikname like '%'||#{word}||'%'
			</when>
			<when test="col=='sikphone'">
				sikphone like '%'||#{word}||'%'
			</when>			
			<when test="col=='address'">
				roadadd like '%'||#{word}||'%'
				or
				jibunadd like '%'||#{word}||'%'
			</when>
		</choose>
	</where>
</select>

<select id="adminlist" parameterType="Map"
		resultType="com.study.sikdang.SikdangDTO">
	select sikid, sikname, sikphone, roadadd, jibunadd,
			sikurl, cox, coy, distance, r
	from (
	select sikid, sikname, sikphone, roadadd, jibunadd,
			sikurl, cox, coy, distance, rownum r
	from (
	select sikid, sikname, sikphone, roadadd, jibunadd,
			sikurl, cox, coy, distance
	from sikdang
	<where>
		<choose>
			<when test="col=='sikid'">
				sikid like '%'||#{word}||'%'
			</when>
			<when test="col=='sikname'">
				sikname like '%'||#{word}||'%'
			</when>
			<when test="col=='sikphone'">
				sikphone like '%'||#{word}||'%'
			</when>			
			<when test="col=='address'">
				roadadd like '%'||#{word}||'%'
				or
				jibunadd like '%'||#{word}||'%'
			</when>
		</choose>
	</where>
	)
	)
	<![CDATA[       
    	where r >= #{sno} and r <= #{eno}
    ]]>
</select>

<delete id="delete" parameterType="String">
	delete from sikdang
	where sikid = #{sikid}
</delete>

<select id="read" parameterType="String" resultType="com.study.sikdang.SikdangDTO">
	select * from sikdang
	where sikid = #{sikid}
</select>

<update id="distance" parameterType="com.study.sikdang.SikdangDTO">
	update sikdang
	set distance = #{distance}
	where sikid = #{sikid}
</update>
    
</mapper>